<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Kamar Kost - Sigura Kost</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/styleEdit.css">
    <style>

    </style>
</head>
<body>
    <div class="container">
        <div class="form-container">
            <div class="form-header">
                <h2><i class="fas fa-edit"></i> Edit Kamar Kost</h2>
            </div>
            
            <form action="/kost/update/<%= kamar._id %>" method="POST" class="form-content" enctype="multipart/form-data">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="namaKamar" class="required">Nama Kamar</label>
                            <input type="text" id="namaKamar" name="namaKamar" class="form-control" value="<%= kamar.nama %>" required>
                            <div class="form-help">Berikan nama yang mudah diingat untuk kamar ini</div>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="harga" class="required">Harga Sewa (per bulan)</label>
                            <input type="number" id="harga" name="harga" class="form-control" value="<%= kamar.harga %>" min="0" required>
                            <div class="form-help">Masukkan harga dalam Rupiah tanpa titik atau koma</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="status" class="required">Status Kamar</label>
                            <select id="status" name="status" class="form-control" required>
                                <option value="kosong" <%= kamar.status === 'kosong' ? 'selected' : '' %>>Kosong</option>
                                <option value="terisi" <%= kamar.status === 'terisi' ? 'selected' : '' %>>Terisi</option>
                                <option value="booking" <%= kamar.status === 'booking' ? 'selected' : '' %>>Booking</option>
                            </select>
                            <div class="form-help">Status akan menentukan apakah kamar bisa dipesan</div>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="tipeKamar">Tipe Kamar</label>
                            <select id="tipeKamar" name="tipeKamar" class="form-control">
                                <option value="standard" <%= kamar.tipeKamar === 'standard' ? 'selected' : '' %>>Standard</option>
                                <option value="deluxe" <%= kamar.tipeKamar === 'deluxe' ? 'selected' : '' %>>Deluxe</option>
                                <option value="executive" <%= kamar.tipeKamar === 'executive' ? 'selected' : '' %>>Executive</option>
                                <option value="family" <%= kamar.tipeKamar === 'family' ? 'selected' : '' %>>Family</option>
                            </select>
                            <div class="form-help">Pilih kategori kamar berdasarkan fasilitas</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="deskripsi" class="required">Deskripsi Kamar</label>
                    <textarea id="deskripsi" name="deskripsi" class="form-control" required><%= kamar.deskripsi %></textarea>
                    <div class="form-help">Deskripsi yang jelas akan menarik lebih banyak calon penghuni</div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="luasKamar">Luas Kamar (mÂ²)</label>
                            <input type="number" id="luasKamar" name="luasKamar" class="form-control" value="<%= kamar.luasKamar %>" min="0" step="0.1">
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="kapasitas">Kapasitas Penghuni</label>
                            <input type="number" id="kapasitas" name="kapasitas" class="form-control" value="<%= kamar.kapasitas %>" min="1">
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="teleponPemilik">Telepon Pemilik</label>
                            <input type="tel" id="teleponPemilik" name="teleponPemilik" class="form-control" value="<%= kamar.telepon %>">
                            <div class="form-help">Nomor telepon pemilik kost</div>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="alamatKost">Alamat Kost</label>
                            <input type="text" id="alamatKost" name="alamatKost" class="form-control" value="<%= kamar.alamat %>">
                            <div class="form-help">Alamat lengkap lokasi kost</div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="foto" class="form-label">Upload Foto Utama Kamar (Opsional)</label>
                    <input type="file" class="form-control" id="foto" name="foto"><br>
                    <small style="color: #666;">Biarkan kosong jika tidak ingin mengubah foto utama</small>
                </div>
                
                <div class="form-group">
                    <label>Foto Utama Saat Ini</label>
                    <div style="position: relative; width: fit-content; margin-top: 10px;">
                        <img src="<%= kamar.foto %>" style="width: 250px; height: 200px; object-fit: cover; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <button type="button" class="btn-action delete-main" style="position: absolute; top: 10px; right: 10px; background: #ff4444; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: 0.3s;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="fotosGaleri" class="form-label">Upload Foto Galeri Kamar Tambahan (Opsional)</label>
                    <input type="file" class="form-control" id="fotosGaleri" name="fotosGaleri" multiple><br>
                    <small style="color: #666;">Anda bisa upload hingga 10 foto tambahan</small>
                </div>

                <% if (galeri && galeri.length > 0) { %>
                    <div class="form-group">
                        <label>Galeri Kamar Saat Ini</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 10px;">
                            <% galeri.forEach(g => { %>
                                <div style="position: relative;" class="galeri-item" data-galeri-id="<%= g._id %>">
                                    <img src="<%= g.foto %>" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                    <div style="position: absolute; top: 5px; right: 5px; display: flex; gap: 5px;">
                                        <button type="button" class="btn-gallery-action delete-galeri" data-galeri-id="<%= g._id %>" style="background: #ff4444; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; transition: 0.3s; hover: background #cc0000;">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                        <button type="button" class="btn-gallery-action replace-galeri" data-galeri-id="<%= g._id %>" style="background: #3498db; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; transition: 0.3s;">
                                            <i class="fas fa-redo"></i>
                                        </button>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                <% } %>
                
                <div class="form-actions">
                    <a href="/kost"><button type="button" class="btn btn-cancel">Batal</button></a>
                    <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <div style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.7);">
            &copy; 2024 Sigura Kost. All rights reserved.
        </div>
    </footer>

    <script>
        // Handle delete galeri
        document.querySelectorAll('.delete-galeri').forEach(btn => {
            btn.addEventListener('click', async (e) => {
                e.preventDefault();
                const galeriId = btn.dataset.galeriId;
                
                if (confirm('Yakin ingin menghapus gambar ini?')) {
                    try {
                        const response = await fetch(`/kost/galeri/${galeriId}`, {
                            method: 'DELETE'
                        });
                        
                        if (response.ok) {
                            btn.closest('.galeri-item').remove();
                        } else {
                            alert('Gagal menghapus gambar');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Terjadi kesalahan');
                    }
                }
            });
        });

        // Handle replace galeri
        document.querySelectorAll('.replace-galeri').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                
                input.addEventListener('change', async (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const formData = new FormData();
                        formData.append('foto', file);
                        formData.append('galeriId', btn.dataset.galeriId);
                        
                        try {
                            const response = await fetch(`/kost/galeri/${btn.dataset.galeriId}`, {
                                method: 'PUT',
                                body: formData
                            });
                            
                            if (response.ok) {
                                const result = await response.json();
                                const imgElement = btn.closest('.galeri-item').querySelector('img');
                                imgElement.src = result.foto;
                                alert('Gambar berhasil diganti');
                            } else {
                                alert('Gagal mengganti gambar');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Terjadi kesalahan');
                        }
                    }
                });
                
                input.click();
            });
        });

        // Handle delete foto utama
        document.querySelector('.delete-main').addEventListener('click', (e) => {
            e.preventDefault();
            alert('Foto utama tidak bisa dihapus. Gunakan form di atas untuk mengganti dengan foto baru.');
        });
    </script>
</body>
</html>